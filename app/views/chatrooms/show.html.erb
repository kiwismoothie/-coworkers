<div id="chatrooms" class="d-flex justify-content-center align-items-center">
  <div class="chatroom mt-3">
    <% other_user = @chatroom.user1 == current_user ? @chatroom.user2 : @chatroom.user1 %>
    <% if other_user.photos.attached? %>
      <%= cl_image_tag(other_user.photos.last.key, height: 70, width: 70, crop: :fill) %>
    <% end %>
    <strong><%= other_user.first_name %></strong>
  </div>
</div>

<div class="container chat-container">
  <div class="chat-container" data-controller="chatroom-subscription"
       data-chatroom-subscription-chatroom-id-value="<%= @chatroom.id %>"
       data-chatroom-subscription-target="messages">
    <% @chatroom.messages.each do |message| %>
      <%= render "messages/message", message: message, current_user: current_user %>
    <% end %>
  </div>

  <div class="form-group msg-form">
    <%= form_with(model: [@chatroom, @message], remote: true, class: "d-flex",
         data: { controller: "reset-form", action: "turbo:submit-end->reset-form#reset" }) do |f| %>
      <%= f.text_field :content, id: 'chat-text', class: "form-control msg-content", autocomplete: 'off' %>
      <%= f.submit "Envoyer", class: "yellow-btn-mini" %>
    <% end %>
  </div>
</div>

<script>
  document.addEventListener('turbo:load', () => {
    const container = document.querySelector('.chat-container');

    container.addEventListener('click', (event) => {
      const messageContainer = event.target.closest('.message-container');
      if (!messageContainer) return;

      const dateElement = messageContainer.querySelector('.message-date1, .message-date2');
      if (dateElement) {
        dateElement.style.display = dateElement.style.display === 'none' ? 'block' : 'none';
      }
    });
  });
</script>
