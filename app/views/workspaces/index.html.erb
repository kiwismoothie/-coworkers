<div class="container">
  <div class="mx-auto mt-4">
    <h1 class="text-center display-4" style="text-shadow: 2px 2px 4px rgba(5, 0, 0, 0.2);">Workspaces</h1>
  </div>

  <div class="text-center mt-2 mb-3">
    <form id="search-form" action="<%= workspaces_path %>" method="GET">
      <div class="search-container">
        <input type="text" id="search-input" class="search-input" placeholder="Où souhaitez-vous télétravailler ?">
        <input type="hidden" id="search-query" name="query">
      </div>
    </form>
  </div>

  <!-- Carte -->
  <% if @no_result %>
      <p> Pas de résultat correspondant à votre recherche</p>
    <% end %>
  <div style="width: 100%; height: 400px;"
    data-controller="map"
    data-map-markers-value="<%= @markers.to_json %>"
    data-map-api-key-value="<%= ENV['MAPBOX_API_KEY'] %>">
  </div>

  <!-- Workspaces -->
  <% @workspaces.each do |workspace| %>
    <a href="<%= workspace_path(workspace) %>" class="custom-link">
      <div class="workspace-card-index">
        <div class="workspace-image-index">
          <div class="image-container-index">
            <%= cl_image_tag workspace.photos.first.key, crop: :fill %>
          </div>
          <%= render 'heart_index', workspace: workspace %>
        </div>
        <div class="card-content-index">
          <%= image_tag workspace.user.photos.first, height: 50, width: 50, class: "avatar2", alt: "Photo" %>
          <span class="workspace-name"><%= workspace.name %></span>
        </div>
      </div>
    </a>
  <% end %>
</div>

<script>
document.addEventListener('turbo:load', function () {
  const searchInput = document.getElementById('search-input');
  const searchForm = document.getElementById('search-form');
  const searchQuery = document.getElementById('search-query');

  function handleSubmit() {
    const inputValue = searchInput.value.trim();
    if (inputValue !== "") {
      searchQuery.value = inputValue;
      searchInput.value = ""; // Réinitialise le champ de texte
      searchForm.submit();
    }
  }

  searchInput.addEventListener('click', function () {
    handleSubmit(); // Gérer le clic directement
  });

  searchInput.addEventListener('keydown', function (event) {
    if (event.key === 'Enter') {
      event.preventDefault();
      handleSubmit();
    }
  });
});
</script>
